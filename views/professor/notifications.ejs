<%- include('../partials/professor/header') %>

<div class="p-6 max-w-5xl mx-auto">

    <div class="flex justify-between items-center mb-6">
        <h2 class="text-3xl font-bold">üîî Notifications</h2>
        <% if (notifications.some(n => !n.read)) { %>
            <form action="<%= user.role === 'student' ? '/student' : '/professor' %>/notifications/mark-all-read" method="POST">
                <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">
                    Mark All as Read
                </button>
            </form>
        <% } %>
        
    </div>

    <div class="bg-white shadow rounded-xl overflow-hidden">

        <% if (notifications.length === 0) { %>
            <div class="p-8 text-center text-gray-500">
                <p class="text-xl">üì≠ No notifications yet</p>
                <p class="text-sm mt-2">You'll be notified about assignment updates here.</p>
            </div>
        <% } else { %>

            <div class="divide-y">
                <% notifications.forEach(notification => { %>
                    <div class="p-4 <%= notification.read ? 'bg-white' : 'bg-blue-50' %> hover:bg-gray-50 transition">
                        
                        <div class="flex items-start justify-between">
                            
                            <div class="flex-1">
                                <!-- Notification Icon based on type -->
                                <div class="flex items-start gap-3">
                                    <div class="text-2xl mt-1">
                                        <% if (notification.type === 'submission') { %>
                                            üì§
                                        <% } else if (notification.type === 'resubmission') { %>
                                            üîÑ
                                        <% } else if (notification.type === 'approved') { %>
                                            ‚úÖ
                                        <% } else if (notification.type === 'rejected') { %>
                                            ‚ùå
                                        <% } else { %>
                                            üîî
                                        <% } %>
                                    </div>

                                    <div class="flex-1">
                                        <p class="<%= notification.read ? 'text-gray-700' : 'text-gray-900 font-semibold' %>">
                                            <%= notification.message %>
                                        </p>

                                        <div class="flex items-center gap-4 mt-2 text-sm text-gray-500">
                                            <span>
                                                <%= notification.createdAt.toLocaleDateString('en-US', { 
                                                    month: 'short', 
                                                    day: 'numeric', 
                                                    year: 'numeric',
                                                    hour: '2-digit',
                                                    minute: '2-digit'
                                                }) %>
                                            </span>

                                            <% if (notification.assignmentId) { %>
                                                <span class="px-2 py-1 bg-gray-200 rounded-full text-xs">
                                                    <%= notification.assignmentId.status %>
                                                </span>
                                            <% } %>

                                            <% if (!notification.read) { %>
                                                <span class="px-2 py-1 bg-blue-500 text-white rounded-full text-xs">
                                                    New
                                                </span>
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="flex items-center gap-2 ml-4">
                                <!-- View Assignment Button -->
                                <% if (notification.assignmentId) { %>
                                    <a href="<%= user.role === 'student' ? '/student/assignments/' + notification.assignmentId._id : '/professor/details/' + notification.assignmentId._id %>" 
                                       class="px-3 py-1 bg-indigo-600 text-white rounded hover:bg-indigo-700 text-sm">
                                        View
                                    </a>
                                <% } %>

                                <!-- Mark as Read Button - FIXED -->
                                <% if (!notification.read) { %>
                                    <form action="<%= user.role === 'student' ? '/student' : '/professor' %>/notifications/<%= notification._id %>/mark-read" method="POST" style="display: inline;">
                                        <button type="submit" class="px-3 py-1 bg-gray-200 text-gray-700 rounded hover:bg-gray-300 text-sm">
                                            Mark Read
                                        </button>
                                    </form>
                                <% } %>
                            </div>

                        </div>
                    </div>
                <% }) %>
            </div>

        <% } %>

    </div>

    <div class="mt-6 text-center">
        <a href="<%= user.role === 'student' ? '/student/dashboard' : '/professor/dashboard' %>" 
           class="text-indigo-600 hover:text-indigo-800">
            ‚Üê Back to Dashboard
        </a>
    </div>

</div>

<%- include('../partials/professor/footer') %>